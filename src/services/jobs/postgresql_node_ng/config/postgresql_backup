#!/bin/bash



PIDFILE=/var/vcap/sys/run/postgresql_node/postgresql_backup.pid
MOUNT_POINT=/var/vcap/services_backup
MT_OPTS="-t nfs"
MT_EXPORT=10.42.246.20:/var/vcap/store/shared

source /var/vcap/packages/common/utils.sh

case $1 in
  start)
    mkdir -p $MOUNT_POINT
    check_mount "$MT_OPTS" "$MT_EXPORT" "$MOUNT_POINT"
    (crontab -l | sed /postgresql_backup/d; cat /var/vcap/jobs/postgresql_node_ng/config/postgresql_backup.cron) | sed /^$/d | crontab

    ;;

  stop)
    crontab -l | sed /postgresql_backup/d | crontab
    kill_and_wait $PIDFILE
    umount $MOUNT_POINT

    ;;

  *)
    echo "Usage: postgresql_backup {start|stop}"

    ;;

esac

